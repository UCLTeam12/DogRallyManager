@model BoardModel
@{
    ViewData["Title"] = "Board";
}
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="~/css/board.css">
        <link rel="stylesheet" href="~/css/chat.css">
        <script src="~/js/include.js"></script>
        <script src="~/js/toggleClass.js"></script>
    </head>
    <body>
        <header>
        <a href="/Account/YourPage"><div class="header-logo-dog"></div><div class="header-logo-txt"></div></a>
        <nav class="header-nav"><a href="/Account/YourPage">Your Page</a><a class="current-page" href="#">Boards</a><a href="/Account/Logout">Log Out</a></nav>
            <div class="clear"></div>
        </header>

        <main id="boards-section">
            <div id="boards-panel">
                <div id="signs">
                    @foreach (var sign in Model.Signs)
                    {
                        <div style="position: absolute;top: @string.Format("{0}px", sign.PositionY);left: @string.Format("{0}px", sign.PositionX);z-index: 9"
                             class="sign"
                             id="@string.Format("sign-{0}",sign.Id)"
                             data-sign-id="@sign.Id">
                            <img src="Images/Signs/@sign.SignType" />
                        </div>
                    }
                    <table>
                        @for (var y = 0; y < 8; y++)
                        {
                            <tr>
                                @for (var x = 0; x < 8; x++)
                                {
                                    var signPiece = Model.Signs.FirstOrDefault(p => p.PositionX == x && p.PositionY == y);
                                    <td>
                                        @if (signPiece != null)
                                        {
                                        }
                                    </td>
                                }
                            </tr>
                        }
                    </table>
                </div>
                <div id="toggle-line-color">
                    <div>Course lines:</div>
                    <br />
                    <div class="switch-container">
                        <label class="switch">
                            <input id="toggle-switch" type="checkbox" />
                            <span class="slider round"></span>
                            <br />
                            <br />
                            <div class="switch-description"></div>
                        </label>
                    </div>
                </div>
            </div>

            <section id="boards-side-panel" class="side-panel">
                <p>This panel can be used to navigate between boards of an event sorted by rounds and dogs.</p>
            </section>

            <div id="board-padding">
                <div id="board">
                    <div id="board-lines">
                        <div id="grass-logo">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Class clear clears both type of floats. -->
            <div class="clear"></div>
        </main>

        <footer>
            <p>This is the footer, which will be implemented, as the header will, as an include across the logged in pages.</p>
        </footer>
        <!-- Including the chat on the board page. -->
    <div>
        @Html.Partial("~/Views/Components/ChatRoomPartial.cshtml", Model.ChatRoom)
    </div>

        <!-- Scripts: -->

        <script>include();</script>

        <script>
            function dragElement(elmnt) {
                var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                if (document.getElementById(elmnt.id + "header")) {
                    /* if present, the header is where you move the DIV from:*/
                    document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
                } else {
                    /* otherwise, move the DIV from anywhere inside the DIV:*/
                    elmnt.onmousedown = dragMouseDown;
                }

                function dragMouseDown(e) {
                    e = e || window.event;
                    e.preventDefault();
                    // get the mouse cursor position at startup:
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closeDragElement;
                    // call a function whenever the cursor moves:
                    document.onmousemove = elementDrag;
                }

                function elementDrag(e) {
                    e = e || window.event;
                    e.preventDefault();
                    // calculate the new cursor position:
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    // set the element's new position:
                    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
                }

                function closeDragElement() {
                    /* stop moving when mouse button is released:*/
                    document.onmouseup = null;
                    document.onmousemove = null;
                    $.post('/Sign/MoveSign', { signId: elmnt.dataset["signId"], newX: elmnt.style.left.replace("px",""), newY: elmnt.style.top.replace("px","") }, function () {
                    });
                }
            }
        </script>

        @foreach(var sign in Model.Signs){
            <script>
                dragElement(document.getElementById(`sign-@sign.Id`));
            </script>
        }

        <!-- Script that changes the background-image of the div with id "board-lines".
             It persists the state of the toggle switch by using the browsers storage. -->

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const toggleSwitch = document.getElementById('toggle-switch');
            const targetDiv = document.getElementById('board-lines');

            function updateBackgroundImage() {
                if (toggleSwitch.checked) {
                    targetDiv.style.backgroundImage = 'url("/Images/dog-rally-track-grass-light-two.png")';
                } else {
                    targetDiv.style.backgroundImage = 'url("/Images/dog-rally-track-grass-dark-two.png")';
                }
            }

            function saveToggleState() {
                localStorage.setItem('toggleState', toggleSwitch.checked ? 'on' : 'off');
            }

            function loadToggleState() {
                const toggleState = localStorage.getItem('toggleState');
                if (toggleState === 'on') {
                    toggleSwitch.checked = true;
                } else {
                    toggleSwitch.checked = false;
                }
            }

            loadToggleState();
            updateBackgroundImage();

            /* Event listener that listens for changes to the state of the toggle switch: */
            toggleSwitch.addEventListener('change', function () {
                updateBackgroundImage();
                saveToggleState();
            });
        });
    </script>
    </body>
</html>